<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(120deg, #eaf2fb 0%, #b6e2d3 60%, #f5f5dc 100%);
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
        }
        body:before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0;
            pointer-events: none;
            background: url('https://www.transparenttextures.com/patterns/hexellence.png'),
                        radial-gradient(circle at 80% 10%, #b6e2d3aa 0%, transparent 60%),
                        radial-gradient(circle at 10% 80%, #f5f5dcaa 0%, transparent 60%);
            opacity: 0.25;
        }
        body:after {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0;
            pointer-events: none;
            background: url('https://www.transparenttextures.com/patterns/hexellence.png'),
                        radial-gradient(circle at 80% 10%, #b6e2d3aa 0%, transparent 60%),
                        radial-gradient(circle at 10% 80%, #f5f5dcaa 0%, transparent 60%);
            opacity: 0.4;
        }
        .header {
            background: linear-gradient(90deg, #b6e2d3 60%, #f5f5dc 100%);
            color: #2d5c8a;
            padding: 22px 0 16px 0;
            text-align: center;
            font-size: 3.2rem;
            letter-spacing: 2.5px;
            box-shadow: 0 4px 32px rgba(0,0,0,0.10);
            border-bottom-left-radius: 60px;
            border-bottom-right-radius: 60px;
            font-family: 'Cairo', Arial, sans-serif;
            font-weight: 900;
            text-shadow: 2px 4px 18px #2d5c8a33, 0 1px 0 #fff;
            position: relative;
            z-index: 2;
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #b6e2d3 0%, #3b5e4d 100%);
            padding: 20px 0;
            z-index: 1000;
            box-shadow: -2px 0 24px rgba(59, 94, 77, 0.15);
            border-top-left-radius: 30px;
            border-bottom-left-radius: 30px;
        }

        .sidebar .brand {
            text-align: center;
            padding: 20px;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
            background: rgba(59, 94, 77, 0.2);
            border-radius: 15px;
            margin: 10px 15px 20px 15px;
        }

        .sidebar .brand i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #f5f5dc;
        }

        .sidebar .brand h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #f5f5dc;
        }

        .sidebar .nav-item {
            display: block;
            padding: 15px 25px;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin: 2px 10px;
            border-radius: 12px;
            cursor: pointer;
        }

        .sidebar .nav-item:hover,
        .sidebar .nav-item.active {
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            padding-right: 35px;
            box-shadow: 0 2px 12px rgba(182, 226, 211, 0.3);
        }

        .sidebar .nav-item i {
            width: 25px;
            margin-left: 15px;
            text-align: center;
        }

        .main-content {
            margin-right: 280px;
            padding: 30px;
            min-height: 100vh;
        }

        .top-bar {
            background: white;
            padding: 20px 30px;
            margin: -30px -30px 30px -30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h1 {
            color: #333;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-card:active {
            transform: translateY(-2px);
        }

        .stat-card.clickable::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .stat-card.clickable:hover::before {
            transform: translateX(100%);
        }

        .stat-card.selected {
            animation: pulse 0.6s ease-in-out;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .stat-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-card.total .icon { color: #3498db; }
        .stat-card.pending .icon { color: #f39c12; }
        .stat-card.progress .icon { color: #e74c3c; }
        .stat-card.completed .icon { color: #27ae60; }
        .stat-card.rating .icon { color: #ff6b35; }

        .stat-card .number {
            font-size: 2.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #666;
            font-size: 1rem;
        }

        .content-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        .refresh-btn {
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 2px 12px rgba(182, 226, 211, 0.3);
        }

        .refresh-btn:hover {
            background: linear-gradient(90deg, #f5f5dc, #b6e2d3);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(182, 226, 211, 0.4);
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .orders-table th,
        .orders-table td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }

        .orders-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        .orders-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
        }

        .status-pending { background: #fff3cd; color: #d68910; border: 1px solid #f39c12; }
        .status-progress { background: #fffbf0; color: #b8860b; border: 1px solid #ffd700; }
        .status-completed { background: #d4edda; color: #155724; border: 1px solid #28a745; }
        .status-rejected { background: #fadbd8; color: #c0392b; border: 1px solid #e74c3c; }

        .status-select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .login-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, rgba(234, 242, 251, 0.95) 0%, rgba(182, 226, 211, 0.95) 60%, rgba(245, 245, 220, 0.95) 100%);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(59, 94, 77, 0.2);
            width: 100%;
            max-width: 420px;
            text-align: center;
            border: 2px solid rgba(182, 226, 211, 0.3);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #b6e2d3 60%, #f5f5dc 100%);
        }

        .login-card h2 {
            color: #2d5c8a;
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(45, 92, 138, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #3b5e4d;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(182, 226, 211, 0.4);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(245, 245, 220, 0.1);
        }

        .form-group input:focus {
            outline: none;
            border-color: #b6e2d3;
            background: white;
            box-shadow: 0 0 0 3px rgba(182, 226, 211, 0.2);
        }

        .login-btn {
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(182, 226, 211, 0.3);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .login-btn:hover {
            background: linear-gradient(90deg, #f5f5dc, #b6e2d3);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(182, 226, 211, 0.4);
        }

        .error-message {
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.1), rgba(255, 255, 255, 0.1));
            color: #c0392b;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid rgba(231, 76, 60, 0.2);
            font-weight: 600;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(90deg, #b6e2d3 60%, #f5f5dc 100%);
            color: #3b5e4d;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .close-btn {
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: #3b5e4d;
            padding: 5px 10px;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .close-btn:hover {
            background: rgba(59, 94, 77, 0.2);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 2px 12px rgba(182, 226, 211, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, #f5f5dc, #b6e2d3);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(182, 226, 211, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            resize: vertical;
            font-family: inherit;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: white;
        }

        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ØªØ­Ø³ÙŠÙ† ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .orders-table {
            font-size: 0.9rem;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(182, 226, 211, 0.2);
        }

        .orders-table th {
            background: linear-gradient(90deg, #b6e2d3 60%, #f5f5dc 100%);
            color: #3b5e4d;
            font-weight: 700;
            text-align: center;
            padding: 15px 10px;
            border: none;
            text-shadow: 0 1px 2px rgba(255,255,255,0.3);
        }

        .orders-table td {
            text-align: center;
            vertical-align: middle;
            padding: 12px 8px;
            border-bottom: 1px solid rgba(182, 226, 211, 0.2);
        }

        .orders-table tr:hover {
            background: rgba(182, 226, 211, 0.1);
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin: 0 2px;
            transition: all 0.3s;
        }

        .edit-btn {
            background: #17a2b8;
            color: white;
        }

        .edit-btn:hover {
            background: #138496;
        }

        .view-btn {
            background: #28a745;
            color: white;
        }

        .view-btn:hover {
            background: #218838;
        }

        .priority-high { background: #dc3545; color: white; }
        .priority-medium { background: #ffc107; color: #333; }
        .priority-low { background: #28a745; color: white; }
        .priority-urgent { background: #6f42c1; color: white; }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .type-badge {
            font-weight: 600;
            text-align: center;
            border: 1px solid;
        }
        .type-technical { background: #e3f2fd; color: #1976d2; border-color: #1976d2; }
        .type-administrative { background: #f3e5f5; color: #7b1fa2; border-color: #7b1fa2; }
        .type-financial { background: #e8f5e8; color: #388e3c; border-color: #388e3c; }
        .type-hr { background: #fff3e0; color: #f57c00; border-color: #f57c00; }
        .type-maintenance { background: #fce4ec; color: #c2185b; border-color: #c2185b; }
        .type-other { background: #f5f5f5; color: #666; border-color: #999; }

        .status-badge {
            font-weight: 600;
            text-align: center;
            border: 1px solid;
        }
        .status-pending { background: #fff3cd; color: #d68910; border-color: #f39c12; }
        .status-in_progress { background: #fffbf0; color: #b8860b; border-color: #ffd700; }
        .status-completed { background: #d4edda; color: #155724; border-color: #28a745; }
        .status-rejected { background: #fadbd8; color: #c0392b; border-color: #e74c3c; }

        .action-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 6px 10px;
            margin: 2px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        .view-btn { color: #007bff; border-color: #007bff; }
        .view-btn:hover { background: #007bff; color: white; }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-right: 0;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                width: 95%;
                margin: 10px;
            }

            .orders-table {
                font-size: 0.8rem;
            }

            .orders-table th,
            .orders-table td {
                padding: 8px 4px;
            }
        }

        /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù„Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª */
        .stat-mini-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .stat-mini-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .stat-mini-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-mini-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d5c8a;
            margin-bottom: 5px;
        }

        .stat-mini-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginForm" class="login-form">
        <div class="login-card">
            <div style="text-align: center; margin-bottom: 20px;">
                <i class="fas fa-user-shield" style="font-size: 3.5rem; color: #2d5c8a; text-shadow: 0 2px 4px rgba(45, 92, 138, 0.3);"></i>
            </div>
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <div id="loginError" class="error-message hidden"></div>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="employeeId">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</label>
                    <input type="text" id="employeeId" value="admin" required>
                </div>
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                    <input type="password" id="password" value="admin123" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
            </form>
        </div>
    </div>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar">
        <div class="brand">
            <i class="fas fa-clipboard-list"></i>
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
        </div>
        <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i>
            Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </a>
        <a href="#orders" class="nav-item" onclick="showSection('orders')">
            <i class="fas fa-clipboard-list"></i>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </a>
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
        <a href="#logout" class="nav-item" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </a>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <div class="top-bar">
            <h1 id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="user-info">
                <span id="currentDateTime"></span>
                <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <strong id="userName">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</strong></span>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Dashboard -->
        <div id="dashboard-section">
            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="icon"><i class="fas fa-clipboard-list"></i></div>
                    <div class="number" id="totalRequests">0</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="stat-card pending clickable" onclick="navigateToOrders('pending')" title="Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">
                    <div class="icon"><i class="fas fa-clock"></i></div>
                    <div class="number" id="pendingRequests">0</div>
                    <div class="label">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="stat-card progress clickable" onclick="navigateToOrders('in_progress')" title="Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°">
                    <div class="icon"><i class="fas fa-cogs"></i></div>
                    <div class="number" id="inProgressRequests">0</div>
                    <div class="label">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
                </div>
                <div class="stat-card completed clickable" onclick="navigateToOrders('completed')" title="Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©">
                    <div class="icon"><i class="fas fa-check-circle"></i></div>
                    <div class="number" id="completedRequests">0</div>
                    <div class="label">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</div>
                </div>
                <div class="stat-card rating clickable" onclick="showAllRatings()" title="Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª">
                    <div class="icon"><i class="fas fa-star"></i></div>
                    <div class="number" id="averageRating">0.0</div>
                    <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3 class="chart-title">Ù†Ø³Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                    <canvas id="pieChart" width="300" height="200"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                    <canvas id="lineChart" width="300" height="200"></canvas>
                </div>
            </div>

            <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h2>
                    <button class="refresh-btn" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
                
                <table class="orders-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ù…Ø¯Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¹Ø¨Ø± JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
                    <button class="refresh-btn" onclick="loadLatestRatings()">
                        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
                
                <table class="orders-table" id="ratingsTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬ÙˆØ¯Ø©</th>
                            <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±Ø¹Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody id="ratingsTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¹Ø¨Ø± JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ø£Ù‚Ø³Ø§Ù… Ø£Ø®Ø±Ù‰ (Ù…Ø®ÙÙŠØ© Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ) -->
        <div id="customers-section" class="hidden">
            <div class="content-section">
                <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                <p>Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
        <div id="all-ratings-section" class="hidden">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="ratingFilter" onchange="filterRatings()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
                            <option value="5">5 Ù†Ø¬ÙˆÙ…</option>
                            <option value="4">4 Ù†Ø¬ÙˆÙ… ÙÙ…Ø§ ÙÙˆÙ‚</option>
                            <option value="3">3 Ù†Ø¬ÙˆÙ… ÙÙ…Ø§ ÙÙˆÙ‚</option>
                            <option value="2">2 Ù†Ø¬ÙˆÙ… ÙÙ…Ø§ ÙÙˆÙ‚</option>
                            <option value="1">1 Ù†Ø¬Ù…Ø© ÙÙ…Ø§ ÙÙˆÙ‚</option>
                        </select>
                        <button class="refresh-btn" onclick="loadAllRatings()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                        <button class="refresh-btn" onclick="goBackToDashboard()">
                            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        </button>
                    </div>
                </div>
                
                <div id="ratingsStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-mini-card">
                        <div class="stat-mini-icon"><i class="fas fa-star" style="color: #ffd700;"></i></div>
                        <div class="stat-mini-number" id="totalRatingsCount">0</div>
                        <div class="stat-mini-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-mini-icon"><i class="fas fa-gem" style="color: #FF6B35;"></i></div>
                        <div class="stat-mini-number" id="avgQualityRating">0.0</div>
                        <div class="stat-mini-label">Ù…ØªÙˆØ³Ø· ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬ÙˆØ¯Ø©</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-mini-icon"><i class="fas fa-tachometer-alt" style="color: #4ECDC4;"></i></div>
                        <div class="stat-mini-number" id="avgSpeedRating">0.0</div>
                        <div class="stat-mini-label">Ù…ØªÙˆØ³Ø· ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±Ø¹Ø©</div>
                    </div>
                    <div class="stat-mini-card">
                        <div class="stat-mini-icon"><i class="fas fa-chart-line" style="color: #28a745;"></i></div>
                        <div class="stat-mini-number" id="overallAvgRating">0.0</div>
                        <div class="stat-mini-label">Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…</div>
                    </div>
                </div>
                
                <table class="orders-table" id="allRatingsTable">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th>
                            <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬ÙˆØ¯Ø©</th>
                            <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±Ø¹Ø©</th>
                            <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</th>
                        </tr>
                    </thead>
                    <tbody id="allRatingsTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¹Ø¨Ø± JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="orders-section" class="hidden">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                    <div style="display: flex; gap: 10px;">
                        <select id="statusFilter" onchange="filterOrders()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="completed">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="rejected">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                        </select>
                        <button class="refresh-btn" onclick="loadAllOrders()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="orders-table" id="allOrdersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø³Ø¨Ø¨/Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                <th>Ø§Ù„Ù…Ø¯Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="allOrdersTableBody">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¹Ø¨Ø± JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
        <div id="editOrderModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                    <span class="close-btn" onclick="closeEditModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editOrderId">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨:</label>
                        <input type="text" id="editOrderName" readonly style="background: #f8f9fa;">
                    </div>
                    <div class="form-group">
                        <label>ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                        <select id="editOrderStatus" onchange="toggleReasonField()">
                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="completed">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="rejected">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                        </select>
                    </div>
                    <div class="form-group" id="reasonGroup">
                        <label>Ø§Ù„Ø³Ø¨Ø¨/Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                        <textarea id="editOrderReason" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn-primary" onclick="saveOrderChanges()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ù…Ù„Ù API -->
    <script src="js/database_new.js"></script>
    
    <script>
        let currentUser = null;
        let requestsData = [];
        let pieChart, lineChart;

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            setupLoginForm();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            setTimeout(() => {
                updateDashboardStats();
            }, 1000);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDateTime').textContent = 
                now.toLocaleString('ar-SA', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function setupLoginForm() {
            const form = document.getElementById('adminLoginForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const employeeId = document.getElementById('employeeId').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (!employeeId || !password) {
                    showError('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©');
                    return;
                }
                
                try {
                    console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
                    
                    // Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡Ù…
                    const allowedUsers = {
                        'admin': { password: 'admin123', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', role: 'admin' },
                        '1001': { password: 'admin123', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', role: 'admin' },
                        'manager': { password: '123456', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', role: 'manager' },
                        'user': { password: '123', name: 'Ù…ÙˆØ¸Ù', role: 'user' },
                        'test': { password: 'test', name: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ', role: 'admin' }
                    };
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
                    const user = allowedUsers[employeeId.toLowerCase()];
                    
                    if (user && user.password === password) {
                        // Ù†Ø¬Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        currentUser = {
                            id: employeeId,
                            username: employeeId,
                            full_name: user.name,
                            role: user.role
                        };
                        
                        document.getElementById('userName').textContent = user.name;
                        document.getElementById('loginForm').classList.add('hidden');
                        document.getElementById('adminDashboard').classList.remove('hidden');
                        
                        showSuccess(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­`);
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        await loadDashboardData();
                        
                    } else {
                        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± API
                        try {
                            const result = await dbAPI.login(employeeId, password);
                            
                            if (result.success) {
                                currentUser = result.user;
                                document.getElementById('userName').textContent = result.user.full_name;
                                document.getElementById('loginForm').classList.add('hidden');
                                document.getElementById('adminDashboard').classList.remove('hidden');
                                await loadDashboardData();
                                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                            } else {
                                showError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                            }
                        } catch (apiError) {
                            console.log('API ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                            showError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                        }
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                    showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        function showSuccess(message) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø§Ø¬Ø­Ø©
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(90deg, #27ae60, #2ecc71);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
                z-index: 9999;
                font-weight: 600;
                animation: slideIn 0.3s ease-out;
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => document.body.removeChild(successDiv), 300);
            }, 3000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Dashboard
        async function loadDashboardData() {
            console.log('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Dashboard...');
            
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const stats = await dbAPI.getStatistics();
                console.log('ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', stats);
                
                if (stats.success) {
                    updateStatCards(stats.data);
                    await loadRequestsTable();
                    createCharts(stats.data);
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', stats.message);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatCards(data) {
            const requests = data.requests || {};
            const ratings = data.ratings || {};
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©
            document.getElementById('totalRequests').textContent = requests.total_requests || 0;
            document.getElementById('pendingRequests').textContent = requests.pending_requests || 0;
            document.getElementById('inProgressRequests').textContent = requests.in_progress_requests || 0;
            document.getElementById('completedRequests').textContent = requests.completed_requests || 0;
            
            // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            const avgQuality = parseFloat(ratings.avg_quality || 0);
            const avgSpeed = parseFloat(ratings.avg_speed || 0);
            const avgRating = ratings.total_ratings > 0 ? ((avgQuality + avgSpeed) / 2).toFixed(1) : '0.0';
            document.getElementById('averageRating').textContent = avgRating;
            
            console.log('ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', {
                total: requests.total_requests,
                pending: requests.pending_requests,
                inProgress: requests.in_progress_requests,
                completed: requests.completed_requests,
                rating: avgRating
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        async function loadRequestsTable() {
            try {
                const result = await dbAPI.getAllRequests();
                
                if (result.success && result.data) {
                    requestsData = result.data;
                    displayOrdersTable(result.data.slice(0, 10)); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 10 Ø·Ù„Ø¨Ø§Øª
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function displayOrdersTable(orders) {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                return;
            }
            
            orders.slice(0, 10).forEach(order => { // Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« 10 Ø·Ù„Ø¨Ø§Øª ÙÙ‚Ø·
                const row = document.createElement('tr');
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                let durationHtml = '';
                if (order.duration_info) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                    durationHtml = order.duration_info.colored_html || order.duration_info.html;
                } else {
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ÙÙŠ JavaScript ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
                    const createdTime = new Date(order.created_at);
                    let endTime;
                    
                    if (order.status === 'completed' && order.updated_at) {
                        endTime = new Date(order.updated_at);
                    } else {
                        endTime = new Date();
                    }
                    
                    const diffTime = Math.abs(endTime - createdTime);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    let durationText = '';
                    if (diffDays === 0) {
                        durationText = 'Ø§Ù„ÙŠÙˆÙ…';
                    } else if (diffDays === 1) {
                        durationText = 'ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯';
                    } else if (diffDays === 2) {
                        durationText = 'ÙŠÙˆÙ…Ø§Ù†';
                    } else if (diffDays >= 3 && diffDays <= 10) {
                        durationText = diffDays + ' Ø£ÙŠØ§Ù…';
                    } else {
                        durationText = diffDays + ' ÙŠÙˆÙ…';
                    }
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…Ø¯Ø©
                    let color = '#666';
                    if (order.status === 'completed') {
                        if (diffDays <= 3) color = '#27ae60';
                        else if (diffDays <= 7) color = '#f39c12';
                        else color = '#e74c3c';
                    } else {
                        if (diffDays <= 7) color = '#3498db';
                        else if (diffDays <= 14) color = '#f39c12';
                        else color = '#e74c3c';
                    }
                    
                    durationHtml = `<span style="color: ${color}; font-weight: bold;"><i class="fa fa-clock" style="margin-left: 5px;"></i> ${durationText}</span>`;
                }
                
                row.innerHTML = `
                    <td><strong>#${order.id}</strong></td>
                    <td style="max-width: 200px; word-wrap: break-word;">${order.subject || 'Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø©'}</td>
                    <td style="color: #2c5aa0; font-weight: bold; max-width: 150px;">${order.display_name || order.customer_name || order.user_name || order.full_name || order.username || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>
                        <span class="type-badge type-${order.request_type || 'other'}" style="padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${getRequestTypeText(order.request_type)}
                        </span>
                    </td>
                    <td>
                        <span class="priority-${order.priority}" style="padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${getPriorityText(order.priority)}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${order.status}" style="padding: 6px 12px; border-radius: 15px; font-size: 0.85rem;">
                            ${getStatusText(order.status)}
                        </span>
                    </td>
                    <td style="font-size: 0.85rem;">
                        ${new Date(order.created_at).toLocaleDateString('ar-SA', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        })}
                    </td>
                    <td style="font-size: 0.85rem; text-align: center;">
                        ${durationHtml}
                    </td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewOrderDetails(${order.id})" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function createCharts(data) {
            const requests = data.requests || {};
            
            // Ù…Ø®Ø·Ø· Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            if (pieChart) pieChart.destroy();
            
            pieChart = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: ['ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°', 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'],
                    datasets: [{
                        data: [
                            requests.completed_requests || 0,
                            requests.in_progress_requests || 0,
                            requests.pending_requests || 0
                        ],
                        backgroundColor: ['#27ae60', '#ffeb3b', '#e74c3c'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
            const lineCtx = document.getElementById('lineChart').getContext('2d');
            if (lineChart) lineChart.destroy();
            
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'],
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
                        data: [65, 59, 80, 81, 56, 55],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        async function updateRequestStatus(requestId, newStatus) {
            try {
                const result = await dbAPI.updateRequestStatus(requestId, newStatus);
                
                if (result.success) {
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    await refreshData();
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:', result.message);
                    alert('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
            }
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
        function viewOrderDetails(orderId) {
            const order = requestsData.find(r => r.id === orderId);
            if (order) {
                alert(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}:\n\nØ§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${order.subject}\nØ§Ù„ÙˆØµÙ: ${order.description}\nØ§Ù„Ø­Ø§Ù„Ø©: ${order.status}\nØ§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${order.priority}`);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function refreshData() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            await loadDashboardData();
            await updateDashboardStats();
            if (document.getElementById('orders-section').classList.contains('hidden') === false) {
                await loadAllOrders();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        async function updateDashboardStats() {
            try {
                console.log('ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† API
                const statsResult = await dbAPI.getStatistics();
                console.log('ğŸ“ˆ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', statsResult);
                
                if (statsResult.success && statsResult.data) {
                    const stats = statsResult.data;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    if (stats.requests) {
                        document.getElementById('totalRequests').textContent = stats.requests.total_requests || 0;
                        document.getElementById('pendingRequests').textContent = stats.requests.pending_requests || 0;
                        document.getElementById('inProgressRequests').textContent = stats.requests.in_progress_requests || 0;
                        document.getElementById('completedRequests').textContent = stats.requests.completed_requests || 0;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                    if (stats.ratings) {
                        const avgQuality = parseFloat(stats.ratings.avg_quality || 0).toFixed(1);
                        const avgSpeed = parseFloat(stats.ratings.avg_speed || 0).toFixed(1);
                        const totalRatings = stats.ratings.total_ratings || 0;
                        
                        // ØªØ­Ø¯ÙŠØ« Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ù†Ø­Ø³Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø©)
                        const avgRating = totalRatings > 0 ? ((parseFloat(avgQuality) + parseFloat(avgSpeed)) / 2).toFixed(1) : '0.0';
                        document.getElementById('averageRating').textContent = avgRating;
                        
                        console.log(`ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª - Ø§Ù„Ø¬ÙˆØ¯Ø©: ${avgQuality}, Ø§Ù„Ø³Ø±Ø¹Ø©: ${avgSpeed}, Ø§Ù„Ù…ØªÙˆØ³Ø·: ${avgRating}`);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                    updatePieChart(stats.requests);
                    updateLineChart(stats.monthly || []);
                    
                    // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                    loadLatestRatings();
                    
                } else {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', statsResult.message);
                    // Ø¹Ø±Ø¶ Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                    document.getElementById('totalRequests').textContent = '0';
                    document.getElementById('pendingRequests').textContent = '0';
                    document.getElementById('inProgressRequests').textContent = '0';
                    document.getElementById('completedRequests').textContent = '0';
                    document.getElementById('averageRating').textContent = '0.0';
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        async function loadAllOrders() {
            try {
                console.log('ğŸ“‹ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...');
                const result = await dbAPI.getAllRequests();
                
                if (result.success && result.data) {
                    requestsData = result.data;
                    displayAllOrdersTable(result.data);
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', result.message);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function displayAllOrdersTable(orders) {
            const tbody = document.getElementById('allOrdersTableBody');
            tbody.innerHTML = '';
            
            console.log('ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:', orders); // Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 20px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
                return;
            }
            
            orders.forEach((order, index) => {
                console.log(`ğŸ“„ Ø§Ù„Ø·Ù„Ø¨ ${index + 1}:`, order); // Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ø·Ù„Ø¨
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                let durationHtml = '';
                if (order.duration_info) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                    durationHtml = order.duration_info.colored_html || order.duration_info.html;
                } else {
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ÙÙŠ JavaScript ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
                    const createdTime = new Date(order.created_at);
                    let endTime;
                    
                    if (order.status === 'completed' && order.updated_at) {
                        endTime = new Date(order.updated_at);
                    } else {
                        endTime = new Date();
                    }
                    
                    const diffTime = Math.abs(endTime - createdTime);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    let durationText = '';
                    if (diffDays === 0) {
                        durationText = 'Ø§Ù„ÙŠÙˆÙ…';
                    } else if (diffDays === 1) {
                        durationText = 'ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯';
                    } else if (diffDays === 2) {
                        durationText = 'ÙŠÙˆÙ…Ø§Ù†';
                    } else if (diffDays >= 3 && diffDays <= 10) {
                        durationText = diffDays + ' Ø£ÙŠØ§Ù…';
                    } else {
                        durationText = diffDays + ' ÙŠÙˆÙ…';
                    }
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…Ø¯Ø©
                    let color = '#666';
                    if (order.status === 'completed') {
                        if (diffDays <= 3) color = '#27ae60';
                        else if (diffDays <= 7) color = '#f39c12';
                        else color = '#e74c3c';
                    } else {
                        if (diffDays <= 7) color = '#3498db';
                        else if (diffDays <= 14) color = '#f39c12';
                        else color = '#e74c3c';
                    }
                    
                    durationHtml = `<span style="color: ${color}; font-weight: bold;"><i class="fa fa-clock" style="margin-left: 5px;"></i> ${durationText}</span>`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>#${order.id}</strong></td>
                    <td style="text-align: right; font-weight: 600;">${order.subject || 'Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø©'}</td>
                    <td style="color: #2c5aa0; font-weight: bold;">${order.display_name || order.customer_name || order.user_name || order.full_name || order.username || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>
                        <span class="status-badge status-${order.request_type || 'general'}" style="padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${getRequestTypeText(order.request_type)}
                        </span>
                    </td>
                    <td>
                        <span class="priority-${order.priority}" style="padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${getPriorityText(order.priority)}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${order.status}" style="padding: 6px 12px; border-radius: 15px; font-size: 0.85rem;">
                            ${getStatusText(order.status)}
                        </span>
                    </td>
                    <td style="max-width: 150px; text-align: right;">
                        <div style="max-height: 40px; overflow: hidden; font-size: 0.85rem; color: #666;">
                            ${order.admin_notes || order.description?.substring(0, 50) + '...' || '-'}
                        </div>
                    </td>
                    <td style="font-size: 0.85rem;">
                        ${new Date(order.created_at).toLocaleDateString('ar-SA', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        })}
                    </td>
                    <td style="font-size: 0.85rem; text-align: center;">
                        ${durationHtml}
                    </td>
                    <td>
                        <button class="action-btn edit-btn" onclick="openEditModal(${order.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn view-btn" onclick="viewOrderDetails(${order.id})" title="Ø¹Ø±Ø¶">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function openEditModal(orderId) {
            const order = requestsData.find(r => r.id === orderId);
            if (!order) return;
            
            document.getElementById('editOrderId').value = order.id;
            document.getElementById('editOrderName').value = order.subject;
            document.getElementById('editOrderStatus').value = order.status;
            document.getElementById('editOrderReason').value = order.admin_notes || '';
            
            toggleReasonField();
            document.getElementById('editOrderModal').classList.remove('hidden');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function closeEditModal() {
            document.getElementById('editOrderModal').classList.add('hidden');
        }

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¨Ø¨
        function toggleReasonField() {
            const status = document.getElementById('editOrderStatus').value;
            const reasonGroup = document.getElementById('reasonGroup');
            const reasonField = document.getElementById('editOrderReason');
            
            if (status === 'rejected' || status === 'completed') {
                reasonGroup.style.display = 'block';
                reasonField.required = status === 'rejected';
                reasonField.placeholder = status === 'rejected' ? 
                    'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶...' : 
                    'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)...';
            } else {
                reasonGroup.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                reasonField.required = false;
                reasonField.placeholder = 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©...';
            }
        }

        // Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø·Ù„Ø¨
        async function saveOrderChanges() {
            const orderId = document.getElementById('editOrderId').value;
            const newStatus = document.getElementById('editOrderStatus').value;
            const reason = document.getElementById('editOrderReason').value.trim();
            
            if ((newStatus === 'rejected' || newStatus === 'completed') && !reason) {
                alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ø¨Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª');
                return;
            }
            
            try {
                console.log('ğŸ’¾ Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø·Ù„Ø¨...');
                const result = await dbAPI.updateRequestStatus(orderId, newStatus, reason);
                
                if (result.success) {
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                    closeEditModal();
                    await loadAllOrders(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    await refreshData(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨:', result.message);
                    alert('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨: ' + result.message);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function filterOrders() {
            const filterValue = document.getElementById('statusFilter').value;
            const filteredData = filterValue ? 
                requestsData.filter(order => order.status === filterValue) : 
                requestsData;
            
            displayAllOrdersTable(filteredData);
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø©
        function navigateToOrders(status) {
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©
            highlightSelectedCard(status);
            
            // Ø§Ù„ØªØ£Ø®ÙŠØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ£Ø«ÙŠØ± Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
            setTimeout(() => {
                window.location.href = `orders.php?status=${status}`;
            }, 300);
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ)
        function filterByStatus(status) {
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ„ØªØ±Ø©
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.value = status;
            }
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const filteredData = requestsData.filter(order => order.status === status);
            displayAllOrdersTable(filteredData);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            const ordersSection = document.getElementById('orders-section');
            if (ordersSection) {
                ordersSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            highlightSelectedCard(status);
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù…
            updateSectionTitle(status);
        }

        // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function highlightSelectedCard(status) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const selectedCard = document.querySelector(`.stat-card.${status === 'in_progress' ? 'progress' : status}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setTimeout(() => {
                    selectedCard.classList.remove('selected');
                }, 2000);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù…
        function updateSectionTitle(status) {
            const statusNames = {
                'pending': 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'in_progress': 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', 
                'completed': 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©',
                'rejected': 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©'
            };
            
            const sectionTitle = document.querySelector('#orders-section .section-title');
            if (sectionTitle) {
                const originalTitle = sectionTitle.dataset.originalTitle || sectionTitle.textContent;
                if (!sectionTitle.dataset.originalTitle) {
                    sectionTitle.dataset.originalTitle = originalTitle;
                }
                
                sectionTitle.textContent = statusNames[status] || originalTitle;
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
                setTimeout(() => {
                    sectionTitle.textContent = originalTitle;
                }, 5000);
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨
        function getRequestTypeText(type) {
            const types = {
                'electricity': 'ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡',
                'plumbing': 'Ø³Ø¨Ø§ÙƒØ© ğŸš°', 
                'ac': 'ØªÙƒÙŠÙŠÙ â„ï¸',
                'it': 'ØªÙ‚Ù†ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ğŸ’»',
                'maintenance': 'ØµÙŠØ§Ù†Ø© Ø¹Ø§Ù…Ø© ğŸ”§',
                'cleaning': 'ØªÙ†Ø¸ÙŠÙ ğŸ§½',
                'security': 'Ø£Ù…Ù† ÙˆØ³Ù„Ø§Ù…Ø© ğŸ›¡ï¸',
                'transportation': 'Ù†Ù‚Ù„ ÙˆÙ…ÙˆØ§ØµÙ„Ø§Øª ğŸš—',
                'supplies': 'Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª ğŸ“¦',
                'other': 'Ø£Ø®Ø±Ù‰ â“',
                'repair': 'Ø¥ØµÙ„Ø§Ø­ ğŸ”¨',
                'replacement': 'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ğŸ”„',
                'return': 'Ø¥Ø±Ø¬Ø§Ø¹ â†©ï¸',
                'exchange': 'ØªØ¨Ø¯ÙŠÙ„ ğŸ”',
                'general': 'Ø¹Ø§Ù… ğŸ“‹',
                'technical': 'ØªÙ‚Ù†ÙŠ ğŸ”§',
                'administrative': 'Ø¥Ø¯Ø§Ø±ÙŠ ğŸ“Š',
                'financial': 'Ù…Ø§Ù„ÙŠ ğŸ’°',
                'hr': 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ© ğŸ‘¥'
            };
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†ÙˆØ¹ ÙØ§Ø±Øº Ø£Ùˆ ØºÙŠØ± Ù…Ø­Ø¯Ø¯
            if (!type || type === null || type === undefined || type === '') {
                return 'â“ ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†ÙˆØ¹ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³
            if (types[type]) {
                return types[type];
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†ÙˆØ¹ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£ØµÙ„Ø§Ù‹
            if (type.length > 0 && /[\u0600-\u06FF]/.test(type)) {
                return type;
            }
            
            // Ø­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            return type || 'ğŸ“‹ Ø¹Ø§Ù…';
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
        function getPriorityText(priority) {
            const priorities = {
                'low': 'Ù…Ù†Ø®ÙØ¶',
                'medium': 'Ù…ØªÙˆØ³Ø·',
                'high': 'Ø¹Ø§Ù„ÙŠ',
                'urgent': 'Ø¹Ø§Ø¬Ù„'
            };
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©
            if (!priority || priority === null || priority === undefined) {
                return 'Ù…ØªÙˆØ³Ø·';
            }
            
            return priorities[priority] || priority || 'Ù…ØªÙˆØ³Ø·';
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø©
        function getStatusText(status) {
            const statuses = {
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',
                'completed': 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°',
                'rejected': 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'
            };
            return statuses[status] || status || 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #d4edda;
                color: #155724;
                padding: 15px 20px;
                border-radius: 8px;
                border: 1px solid #c3e6cb;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                font-weight: 600;
            `;
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function showSection(sectionName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                const sectionNames = {
                    'dashboard': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
                    'orders': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª'
                };
                
                document.getElementById('pageTitle').textContent = sectionNames[sectionName] || sectionName;
                
                // Ø¥Ø¶Ø§ÙØ© active Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯
                event.target.classList.add('active');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
                if (sectionName === 'orders') {
                    loadAllOrders();
                }
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                currentUser = null;
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('employeeId').value = '1001';
                document.getElementById('password').value = 'admin123';
                document.getElementById('adminDashboard').classList.add('hidden');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ
        function updatePieChart(requestsStats) {
            const ctx = document.getElementById('pieChart');
            if (!ctx) return;
            
            if (pieChart) {
                pieChart.destroy();
            }
            
            const data = {
                labels: ['Ù…ØªÙƒÙ…Ù„Ø©', 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'],
                datasets: [{
                    data: [
                        requestsStats?.completed_requests || 0,
                        requestsStats?.in_progress_requests || 0,
                        requestsStats?.pending_requests || 0,
                        requestsStats?.rejected_requests || 0
                    ],
                    backgroundColor: ['#4CAF50', '#ffeb3b', '#FF9800', '#F44336'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            };
            
            pieChart = new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø®Ø·ÙŠ
        function updateLineChart(monthlyData) {
            const ctx = document.getElementById('lineChart');
            if (!ctx) return;
            
            if (lineChart) {
                lineChart.destroy();
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¢Ø®Ø± 6 Ø£Ø´Ù‡Ø±
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'];
            let data = [2, 4, 3, 5, 2, 6]; // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            
            if (monthlyData && monthlyData.length > 0) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¥Ø°Ø§ ØªÙˆÙØ±Øª
                data = monthlyData.slice(-6).map(item => item.monthly_count || 0);
            }
            
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
                        data: data,
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
        async function loadLatestRatings() {
            try {
                console.log('â­ Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...');
                const result = await dbAPI.getRatings();
                console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', result);
                
                if (result.success && result.ratings) {
                    displayLatestRatings(result.ratings.slice(0, 5)); // Ø£Ø­Ø¯Ø« 5 ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                } else {
                    console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…ØªØ§Ø­Ø©');
                    displayLatestRatings([]);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', error);
                displayLatestRatings([]);
            }
        }

        // Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
        function displayLatestRatings(ratings) {
            const tbody = document.getElementById('ratingsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (!ratings || ratings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</td></tr>';
                return;
            }
            
            ratings.forEach(rating => {
                const row = document.createElement('tr');
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const date = new Date(rating.created_at);
                const formattedDate = date.toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ø¬ÙˆÙ…
                const qualityStars = 'â˜…'.repeat(rating.quality_rate || 0) + 'â˜†'.repeat(5 - (rating.quality_rate || 0));
                const speedStars = 'â˜…'.repeat(rating.speed_rate || 0) + 'â˜†'.repeat(5 - (rating.speed_rate || 0));
                
                row.innerHTML = `
                    <td><strong>#${rating.request_id || '-'}</strong></td>
                    <td>${rating.subject || 'Ø·Ù„Ø¨ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${rating.customer_name || rating.full_name || rating.display_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td style="color: #FF6B35;">${qualityStars}</td>
                    <td style="color: #4ECDC4;">${speedStars}</td>
                    <td>${formattedDate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ
        function getRequestTypeText(type) {
            const types = {
                'technical': 'ØªÙ‚Ù†ÙŠ',
                'administrative': 'Ø¥Ø¯Ø§Ø±ÙŠ',
                'financial': 'Ù…Ø§Ù„ÙŠ',
                'hr': 'Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©',
                'maintenance': 'ØµÙŠØ§Ù†Ø©',
                'other': 'Ø£Ø®Ø±Ù‰'
            };
            return types[type] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        function getPriorityText(priority) {
            const priorities = {
                'low': 'Ù…Ù†Ø®ÙØ¶Ø©',
                'medium': 'Ù…ØªÙˆØ³Ø·Ø©',
                'high': 'Ø¹Ø§Ù„ÙŠØ©',
                'urgent': 'Ø¹Ø§Ø¬Ù„Ø©'
            };
            return priorities[priority] || 'Ù…ØªÙˆØ³Ø·Ø©';
        }

        function getStatusText(status) {
            const statuses = {
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',
                'completed': 'Ù…ÙƒØªÙ…Ù„Ø©',
                'rejected': 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'
            };
            return statuses[status] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
        function showAllRatings() {
            console.log('ğŸŒŸ Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...');
            
            // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('all-ratings-section').classList.remove('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            document.getElementById('pageTitle').textContent = 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª';
            
            // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
            loadAllRatings();
        }

        function goBackToDashboard() {
            console.log('ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
            
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('all-ratings-section').classList.add('hidden');
            document.getElementById('dashboard-section').classList.remove('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            document.getElementById('pageTitle').textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…';
        }

        async function loadAllRatings() {
            try {
                console.log('ğŸ“Š Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...');
                const result = await dbAPI.getRatings();
                
                if (result.success && result.ratings) {
                    displayAllRatings(result.ratings);
                    updateRatingsStats(result.ratings);
                } else {
                    console.log('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…ØªØ§Ø­Ø©');
                    displayAllRatings([]);
                    updateRatingsStats([]);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:', error);
                displayAllRatings([]);
                updateRatingsStats([]);
            }
        }

        function displayAllRatings(ratings) {
            const tbody = document.getElementById('allRatingsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (!ratings || ratings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª</td></tr>';
                return;
            }
            
            ratings.forEach(rating => {
                const row = document.createElement('tr');
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const date = new Date(rating.created_at);
                const formattedDate = date.toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ø¬ÙˆÙ…
                const qualityStars = 'â˜…'.repeat(rating.quality_rate || 0) + 'â˜†'.repeat(5 - (rating.quality_rate || 0));
                const speedStars = 'â˜…'.repeat(rating.speed_rate || 0) + 'â˜†'.repeat(5 - (rating.speed_rate || 0));
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø·
                const avgRating = ((rating.quality_rate || 0) + (rating.speed_rate || 0)) / 2;
                const avgStars = 'â˜…'.repeat(Math.round(avgRating)) + 'â˜†'.repeat(5 - Math.round(avgRating));
                
                row.innerHTML = `
                    <td><strong>#${rating.request_id || '-'}</strong></td>
                    <td style="color: #2c5aa0; font-weight: bold;">${rating.customer_name || rating.full_name || rating.display_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${rating.subject || 'Ø·Ù„Ø¨ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td style="color: #FF6B35;">${qualityStars}</td>
                    <td style="color: #4ECDC4;">${speedStars}</td>
                    <td style="color: #ffd700; font-weight: bold;">${avgStars} (${avgRating.toFixed(1)})</td>
                    <td>${formattedDate}</td>
                    <td style="max-width: 200px; word-wrap: break-word;">${rating.comment || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateRatingsStats(ratings) {
            if (!ratings || ratings.length === 0) {
                document.getElementById('totalRatingsCount').textContent = '0';
                document.getElementById('avgQualityRating').textContent = '0.0';
                document.getElementById('avgSpeedRating').textContent = '0.0';
                document.getElementById('overallAvgRating').textContent = '0.0';
                return;
            }
            
            const totalRatings = ratings.length;
            const totalQuality = ratings.reduce((sum, rating) => sum + (rating.quality_rate || 0), 0);
            const totalSpeed = ratings.reduce((sum, rating) => sum + (rating.speed_rate || 0), 0);
            
            const avgQuality = totalRatings > 0 ? (totalQuality / totalRatings).toFixed(1) : '0.0';
            const avgSpeed = totalRatings > 0 ? (totalSpeed / totalRatings).toFixed(1) : '0.0';
            const overallAvg = totalRatings > 0 ? ((parseFloat(avgQuality) + parseFloat(avgSpeed)) / 2).toFixed(1) : '0.0';
            
            document.getElementById('totalRatingsCount').textContent = totalRatings;
            document.getElementById('avgQualityRating').textContent = avgQuality;
            document.getElementById('avgSpeedRating').textContent = avgSpeed;
            document.getElementById('overallAvgRating').textContent = overallAvg;
        }

        function filterRatings() {
            const filterValue = document.getElementById('ratingFilter').value;
            const tbody = document.getElementById('allRatingsTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (row.cells.length < 6) continue; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
                
                const avgCell = row.cells[5].textContent; // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…ØªÙˆØ³Ø·
                const avgMatch = avgCell.match(/\((\d+\.?\d*)\)/);
                const avgRating = avgMatch ? parseFloat(avgMatch[1]) : 0;
                
                if (!filterValue || avgRating >= parseFloat(filterValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>