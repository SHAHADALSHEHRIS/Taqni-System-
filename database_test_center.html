<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: linear-gradient(120deg, #eaf2fb 0%, #b6e2d3 60%, #f5f5dc 100%);
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        .header {
            background: linear-gradient(90deg, #b6e2d3 60%, #f5f5dc 100%);
            color: #2d5c8a;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .test-controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .test-btn {
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        .test-btn:hover {
            background: linear-gradient(90deg, #f5f5dc, #b6e2d3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .test-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .test-results {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .test-section.pending {
            background: #fff9e6;
            border-left-color: #ffa500;
        }

        .test-section.success {
            background: #e8f5e8;
            border-left-color: #28a745;
        }

        .test-section.error {
            background: #f5e8e8;
            border-left-color: #dc3545;
        }

        .test-section.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .test-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-details {
            margin: 10px 0;
        }

        .test-item {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .test-item.success {
            background: #d4edda;
            color: #155724;
        }

        .test-item.error {
            background: #f8d7da;
            color: #721c24;
        }

        .test-item.warning {
            background: #fff3cd;
            color: #856404;
        }

        .test-item.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loader.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d5c8a;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .nav-links {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        .nav-link {
            display: inline-block;
            background: linear-gradient(90deg, #b6e2d3, #f5f5dc);
            color: #3b5e4d;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 5px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-link:hover {
            background: linear-gradient(90deg, #f5f5dc, #b6e2d3);
            transform: translateY(-2px);
            color: #3b5e4d;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .test-controls {
                flex-direction: column;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </div>

        <div class="test-controls">
            <button class="test-btn" onclick="runQuickTest()">
                <i class="fas fa-play"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹
            </button>
            <button class="test-btn" onclick="runFullTest()">
                <i class="fas fa-cogs"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„
            </button>
            <button class="test-btn" onclick="testAPI()">
                <i class="fas fa-code"></i>
                Ø§Ø®ØªØ¨Ø§Ø± API
            </button>
            <button class="test-btn" onclick="clearResults()">
                <i class="fas fa-eraser"></i>
                Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            </button>
        </div>

        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...</p>
        </div>

        <div class="test-results" id="testResults" style="display: none;">
            <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>

        <div class="nav-links">
            <h3 style="color: #2d5c8a; margin-bottom: 15px;">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
            <a href="connection_test.php" class="nav-link" target="_blank">
                <i class="fas fa-external-link-alt"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„
            </a>
            <a href="test_db_connection.php" class="nav-link" target="_blank">
                <i class="fas fa-database"></i>
                Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª JSON
            </a>
            <a href="admin.html" class="nav-link">
                <i class="fas fa-tachometer-alt"></i>
                Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </a>
            <a href="request.html" class="nav-link">
                <i class="fas fa-plus"></i>
                Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨
            </a>
        </div>
    </div>

    <script>
        let testResults = {};

        function showLoader() {
            document.getElementById('loader').classList.add('active');
            document.getElementById('testResults').style.display = 'none';
        }

        function hideLoader() {
            document.getElementById('loader').classList.remove('active');
            document.getElementById('testResults').style.display = 'block';
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('testResults').style.display = 'none';
            testResults = {};
        }

        async function runQuickTest() {
            showLoader();
            
            try {
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø³Ø±ÙŠØ¹
                const response = await fetch('test_db_connection.php');
                const result = await response.json();
                
                displayQuickResults(result);
            } catch (error) {
                displayError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹: ' + error.message);
            }
            
            hideLoader();
        }

        async function runFullTest() {
            showLoader();
            
            try {
                // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„
                const response = await fetch('connection_test.php');
                const html = await response.text();
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const body = doc.body.innerHTML;
                
                displayFullResults(body);
            } catch (error) {
                displayError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„: ' + error.message);
            }
            
            hideLoader();
        }

        async function testAPI() {
            showLoader();
            
            const apiTests = [
                { name: 'Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', url: 'api/requests.php', method: 'POST', body: {action: 'get_all'} },
                { name: 'Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', url: 'api/ratings.php', method: 'GET', body: null },
                { name: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', url: 'api/stats.php', method: 'GET', body: null }
            ];
            
            const results = [];
            
            for (const test of apiTests) {
                try {
                    const options = {
                        method: test.method,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    };
                    
                    if (test.body) {
                        options.body = JSON.stringify(test.body);
                    }
                    
                    const response = await fetch(test.url, options);
                    const result = await response.json();
                    
                    results.push({
                        name: test.name,
                        status: response.ok ? 'success' : 'error',
                        data: result,
                        url: test.url
                    });
                } catch (error) {
                    results.push({
                        name: test.name,
                        status: 'error',
                        error: error.message,
                        url: test.url
                    });
                }
            }
            
            displayAPIResults(results);
            hideLoader();
        }

        function displayQuickResults(result) {
            const container = document.getElementById('testResults');
            
            let html = '<h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹</h2>';
            
            // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            const status = result.success ? 'success' : 'error';
            html += `<div class="test-section ${status}">
                <div class="test-title">
                    <i class="fas fa-${result.success ? 'check-circle' : 'times-circle'}"></i>
                    Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
                </div>
                <div class="test-item ${status}">
                    <i class="fas fa-${result.success ? 'check' : 'times'}"></i>
                    ${result.message}
                </div>
            </div>`;
            
            // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            if (result.details) {
                html += '<div class="test-section info"><div class="test-title"><i class="fas fa-info-circle"></i>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
                
                for (const [key, value] of Object.entries(result.details)) {
                    if (typeof value === 'string') {
                        const itemClass = value.includes('âœ…') ? 'success' : value.includes('âŒ') ? 'error' : 'info';
                        html += `<div class="test-item ${itemClass}">${value}</div>`;
                    }
                }
                html += '</div>';
            }
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (result.details && result.details.data_counts) {
                html += '<div class="test-section info"><div class="test-title"><i class="fas fa-table"></i>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</div>';
                html += '<table class="data-table"><thead><tr><th>Ø§Ù„Ø¬Ø¯ÙˆÙ„</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</th></tr></thead><tbody>';
                
                for (const [table, count] of Object.entries(result.details.data_counts)) {
                    html += `<tr><td>${table}</td><td>${count}</td></tr>`;
                }
                html += '</tbody></table></div>';
            }
            
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
            if (result.system_info) {
                html += '<div class="test-section info"><div class="test-title"><i class="fas fa-server"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>';
                html += '<table class="data-table"><thead><tr><th>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody>';
                
                const systemLabels = {
                    'php_version': 'Ø¥ØµØ¯Ø§Ø± PHP',
                    'mysql_available': 'MySQL Ù…ØªØ§Ø­',
                    'server_software': 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø®Ø§Ø¯Ù…',
                    'server_time': 'ÙˆÙ‚Øª Ø§Ù„Ø®Ø§Ø¯Ù…',
                    'timezone': 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©'
                };
                
                for (const [key, value] of Object.entries(result.system_info)) {
                    const label = systemLabels[key] || key;
                    html += `<tr><td>${label}</td><td>${value}</td></tr>`;
                }
                html += '</tbody></table></div>';
            }
            
            container.innerHTML = html;
        }

        function displayFullResults(htmlContent) {
            const container = document.getElementById('testResults');
            container.innerHTML = '<h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„</h2>' + htmlContent;
        }

        function displayAPIResults(results) {
            const container = document.getElementById('testResults');
            
            let html = '<h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± API</h2>';
            
            const successCount = results.filter(r => r.status === 'success').length;
            const totalCount = results.length;
            
            html += `<div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle" style="color: #28a745;"></i></div>
                    <div class="stat-number">${successCount}</div>
                    <div class="stat-label">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø§Ø¬Ø­Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-times-circle" style="color: #dc3545;"></i></div>
                    <div class="stat-number">${totalCount - successCount}</div>
                    <div class="stat-label">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ§Ø´Ù„Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-percentage" style="color: #007bff;"></i></div>
                    <div class="stat-number">${Math.round((successCount / totalCount) * 100)}%</div>
                    <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                </div>
            </div>`;
            
            for (const result of results) {
                const status = result.status === 'success' ? 'success' : 'error';
                html += `<div class="test-section ${status}">
                    <div class="test-title">
                        <i class="fas fa-${result.status === 'success' ? 'check-circle' : 'times-circle'}"></i>
                        ${result.name}
                    </div>
                    <div class="test-item info">
                        <i class="fas fa-link"></i>
                        URL: ${result.url}
                    </div>`;
                
                if (result.error) {
                    html += `<div class="test-item error">
                        <i class="fas fa-exclamation-triangle"></i>
                        Ø®Ø·Ø£: ${result.error}
                    </div>`;
                } else if (result.data) {
                    html += `<div class="test-item success">
                        <i class="fas fa-check"></i>
                        Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©: ${JSON.stringify(result.data).substring(0, 100)}...
                    </div>`;
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function displayError(message) {
            const container = document.getElementById('testResults');
            container.innerHTML = `
                <div class="test-section error">
                    <div class="test-title">
                        <i class="fas fa-times-circle"></i>
                        Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„
                    </div>
                    <div class="test-item error">
                        <i class="fas fa-exclamation-triangle"></i>
                        ${message}
                    </div>
                </div>
            `;
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', function() {
            setTimeout(runQuickTest, 1000);
        });
    </script>
</body>
</html>