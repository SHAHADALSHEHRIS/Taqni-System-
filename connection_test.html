<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ø§ØªØµØ§Ù„</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .testing { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        h1 { color: #333; text-align: center; }
        .test-result { margin: 15px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</h1>
        
        <div id="server-status" class="status testing">
            ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...
        </div>
        
        <div id="db-status" class="status testing">
            ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
        </div>
        
        <div id="api-status" class="status testing">
            ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ APIs...
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="testAll()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
            <button class="btn" onclick="window.location.href='admin.html'">ğŸ“Š ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
            <button class="btn" onclick="window.location.href='system_check.html'">ğŸ” ÙØ­Øµ Ø´Ø§Ù…Ù„</button>
        </div>
        
        <div id="test-results"></div>
        
        <div class="test-result">
            <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©:</h3>
            <ul>
                <li><strong>Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong> <a href="admin.html">admin.html</a></li>
                <li><strong>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</strong> 1001</li>
                <li><strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong> admin123</li>
                <li><strong>Ø§Ù„Ø®Ø§Ø¯Ù…:</strong> http://localhost/projeect/</li>
            </ul>
        </div>
    </div>

    <script>
        let testResults = [];

        function updateStatus(elementId, message, isSuccess = null) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            
            if (isSuccess === true) {
                element.className = 'status success';
            } else if (isSuccess === false) {
                element.className = 'status error';
            } else {
                element.className = 'status testing';
            }
        }

        function addTestResult(test, result, details = '') {
            testResults.push({ test, result, details, time: new Date().toLocaleTimeString() });
            updateTestResults();
        }

        function updateTestResults() {
            const container = document.getElementById('test-results');
            if (testResults.length === 0) return;
            
            container.innerHTML = '<h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:</h3>' + 
                testResults.map(r => `
                    <div class="test-result">
                        <strong>${r.result ? 'âœ…' : 'âŒ'} ${r.test}</strong> - ${r.time}
                        ${r.details ? `<br><small>${r.details}</small>` : ''}
                    </div>
                `).join('');
        }

        async function testServer() {
            updateStatus('server-status', 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø®Ø§Ø¯Ù…...');
            
            try {
                const response = await fetch('test_connection.php');
                if (response.ok) {
                    updateStatus('server-status', 'âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ', true);
                    addTestResult('Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…', true, 'HTTP Status: ' + response.status);
                    return true;
                } else {
                    updateStatus('server-status', 'âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ' + response.status, false);
                    addTestResult('Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…', false, 'HTTP Status: ' + response.status);
                    return false;
                }
            } catch (error) {
                updateStatus('server-status', 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ' + error.message, false);
                addTestResult('Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…', false, error.message);
                return false;
            }
        }

        async function testDatabase() {
            updateStatus('db-status', 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            
            try {
                const response = await fetch('api_test_simple.php');
                const data = await response.json();
                
                if (data.success) {
                    updateStatus('db-status', `âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØµÙ„Ø© (${data.total_requests} Ø·Ù„Ø¨)`, true);
                    addTestResult('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', true, `${data.total_requests} Ø·Ù„Ø¨Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©`);
                    return true;
                } else {
                    updateStatus('db-status', 'âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + data.error, false);
                    addTestResult('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', false, data.error);
                    return false;
                }
            } catch (error) {
                updateStatus('db-status', 'âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, false);
                addTestResult('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', false, error.message);
                return false;
            }
        }

        async function testAPIs() {
            updateStatus('api-status', 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ APIs...');
            
            try {
                // Test Statistics API
                const statsResponse = await fetch('api/requests.php?action=getStatistics');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    updateStatus('api-status', 'âœ… Ø¬Ù…ÙŠØ¹ APIs ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ', true);
                    addTestResult('APIs', true, 'API Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙŠØ¹Ù…Ù„');
                    return true;
                } else {
                    updateStatus('api-status', 'âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ APIs', false);
                    addTestResult('APIs', false, 'ÙØ´Ù„ API Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
                    return false;
                }
            } catch (error) {
                updateStatus('api-status', 'âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ APIs: ' + error.message, false);
                addTestResult('APIs', false, error.message);
                return false;
            }
        }

        async function testAll() {
            testResults = []; // Clear previous results
            updateTestResults();
            
            const serverOk = await testServer();
            if (serverOk) {
                await testDatabase();
                await testAPIs();
            }
        }

        // Run tests on page load
        window.onload = testAll;
    </script>
</body>
</html>