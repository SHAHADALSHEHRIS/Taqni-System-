<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a8b; }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
    
    <button onclick="testAPI()">Ø§Ø®ØªØ¨Ø§Ø± API</button>
    <button onclick="testStats()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    <button onclick="testRatings()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
    <button onclick="testRequests()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button onclick="addTestData()">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
    
    <div id="results"></div>

    <script>
        function addResult(title, data, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result';
            resultDiv.style.background = isSuccess ? '#d4edda' : '#f8d7da';
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }

        async function testAPI() {
            try {
                const response = await fetch('http://localhost/projeect/api/requests.php?action=test');
                const data = await response.json();
                addResult('âœ… Ø§Ø®ØªØ¨Ø§Ø± API', data, data.success);
            } catch (error) {
                addResult('âŒ Ø®Ø·Ø£ ÙÙŠ API', { error: error.message }, false);
            }
        }

        async function testStats() {
            try {
                const response = await fetch('http://localhost/projeect/api/requests.php?action=get_statistics');
                const data = await response.json();
                addResult('ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', data, data.success);
            } catch (error) {
                addResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', { error: error.message }, false);
            }
        }

        async function testRatings() {
            try {
                const response = await fetch('http://localhost/projeect/api/requests.php?action=get_ratings');
                const data = await response.json();
                addResult('â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', data, data.success);
            } catch (error) {
                addResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', { error: error.message }, false);
            }
        }

        async function testRequests() {
            try {
                const response = await fetch('http://localhost/projeect/api/requests.php?action=get_all');
                const data = await response.json();
                addResult('ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', data, data.success);
            } catch (error) {
                addResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', { error: error.message }, false);
            }
        }

        async function addTestData() {
            try {
                // Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ
                const requestData = {
                    action: 'create',
                    user_id: 2,
                    request_type: 'technical',
                    subject: 'Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    description: 'Ù‡Ø°Ø§ Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    priority: 'medium'
                };

                const response = await fetch('http://localhost/projeect/api/requests.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();
                addResult('â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©', data, data.success);

                // Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                if (data.success && data.id) {
                    const ratingData = {
                        action: 'rate_request',
                        request_id: data.id,
                        user_id: 2,
                        quality_rate: 4,
                        speed_rate: 5,
                        comments: 'ØªÙ‚ÙŠÙŠÙ… ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù…ØªØ§Ø²'
                    };

                    const ratingResponse = await fetch('http://localhost/projeect/api/requests.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(ratingData)
                    });

                    const ratingResult = await ratingResponse.json();
                    addResult('â­ Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… ØªØ¬Ø±ÙŠØ¨ÙŠ', ratingResult, ratingResult.success);
                }

            } catch (error) {
                addResult('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', { error: error.message }, false);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>