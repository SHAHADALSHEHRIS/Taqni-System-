<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f8f9fa; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ÙƒØªÙ…Ù„ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h1>
        
        <div class="success">
            <h3>âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:</h3>
            <ul>
                <li><strong>ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹</strong> âœ…</li>
                <li><strong>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙŠØ¹Ù…Ù„ ÙÙ‚Ø· Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</strong> âœ…</li>
                <li><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ØªÙØ­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong> âœ…</li>
                <li><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</strong> âœ…</li>
                <li><strong>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong> âœ…</li>
            </ul>
        </div>

        <div class="info">
            <h3>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
            <div id="systemStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="warning">
            <h3>ğŸ” ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</h3>
            <ol>
                <li>ØªÙ‚Ø¯Ù… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ØµÙØ­Ø© <strong>request.html</strong></li>
                <li>ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                <li>Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°"</li>
                <li>ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ØŒ ÙŠØ¸Ù‡Ø± Ø²Ø± "ØªÙ‚ÙŠÙŠÙ…" ÙÙ‚Ø· Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</li>
                <li>Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ ÙŠÙØ­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</li>
            </ol>
        </div>

        <h3>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø§Øª:</h3>
        <a href="request.html" class="btn btn-primary" target="_blank">ğŸ“ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨</a>
        <a href="track.html" class="btn btn-info" target="_blank">ğŸ” ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
        <a href="admin.html" class="btn btn-success" target="_blank">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>

        <h3>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</h3>
        <div id="statsSection">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <script src="js/api.js"></script>
    <script>
        async function loadSystemStatus() {
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                const requestsResult = await dbAPI.getAllRequests();
                
                // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                const ratingsResult = await dbAPI.getRatings();
                const ratingsStats = await dbAPI.getRatingsStats();
                
                if (requestsResult.success) {
                    const requests = requestsResult.data || requestsResult.requests || [];
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    const stats = {
                        total: requests.length,
                        pending: requests.filter(r => r.status === 'pending').length,
                        in_progress: requests.filter(r => r.status === 'in_progress').length,
                        completed: requests.filter(r => r.status === 'completed').length,
                        rejected: requests.filter(r => r.status === 'rejected').length
                    };
                    
                    document.getElementById('systemStatus').innerHTML = `
                        <table>
                            <tr><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th><td>${stats.total}</td></tr>
                            <tr><th>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</th><td>${stats.pending}</td></tr>
                            <tr><th>Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</th><td>${stats.in_progress}</td></tr>
                            <tr><th style="color: green;">Ù…ÙƒØªÙ…Ù„Ø© (ÙŠÙ…ÙƒÙ† ØªÙ‚ÙŠÙŠÙ…Ù‡Ø§)</th><td>${stats.completed}</td></tr>
                            <tr><th>Ù…Ø±ÙÙˆØ¶Ø©</th><td>${stats.rejected}</td></tr>
                        </table>
                    `;
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                    const recentRequests = requests.slice(0, 5);
                    let requestsTable = `
                        <h4>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</h4>
                        <table>
                            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
                    `;
                    
                    recentRequests.forEach(req => {
                        let statusColor = '';
                        switch(req.status) {
                            case 'completed': statusColor = 'color: #28a745; font-weight: bold;'; break;
                            case 'in_progress': statusColor = 'color: #ffc107; font-weight: bold;'; break;
                            case 'pending': statusColor = 'color: #dc3545; font-weight: bold;'; break;
                            case 'rejected': statusColor = 'color: #6c757d; font-weight: bold;'; break;
                        }
                        
                        requestsTable += `
                            <tr>
                                <td>#${req.id}</td>
                                <td>${(req.subject || '').substring(0, 30)}...</td>
                                <td>${req.request_type}</td>
                                <td style="${statusColor}">${req.status}</td>
                            </tr>
                        `;
                    });
                    
                    requestsTable += '</table>';
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                    let ratingsInfo = '';
                    if (ratingsResult.success && ratingsResult.data && ratingsResult.data.length > 0) {
                        const ratings = ratingsResult.data;
                        ratingsInfo = `
                            <h4>Ø¢Ø®Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</h4>
                            <table>
                                <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</th></tr>
                        `;
                        
                        ratings.slice(0, 3).forEach(rating => {
                            const stars = 'â­'.repeat(rating.rating);
                            const comment = rating.comment ? 
                                (rating.comment.length > 30 ? rating.comment.substring(0, 30) + '...' : rating.comment) : 
                                'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚';
                            
                            ratingsInfo += `
                                <tr>
                                    <td>#${rating.request_id}</td>
                                    <td>${stars} (${rating.rating}/5)</td>
                                    <td>${comment}</td>
                                </tr>
                            `;
                        });
                        
                        ratingsInfo += '</table>';
                        
                        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
                        if (ratingsStats.success && ratingsStats.data) {
                            const stats = ratingsStats.data;
                            ratingsInfo += `
                                <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª:</strong> ${stats.total_ratings}</p>
                                <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${parseFloat(stats.average_rating || 0).toFixed(1)} â­</p>
                            `;
                        }
                    } else {
                        ratingsInfo = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                    }
                    
                    document.getElementById('statsSection').innerHTML = requestsTable + ratingsInfo;
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                document.getElementById('systemStatus').innerHTML = '<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                document.getElementById('statsSection').innerHTML = '<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', loadSystemStatus);
    </script>
</body>
</html>