<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #34495e;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #2980b9;
        }
        button.success {
            background: #27ae60;
        }
        button.error {
            background: #e74c3c;
        }
        .result {
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success-result {
            border-color: #27ae60;
            background: #d5f4e6;
        }
        .error-result {
            border-color: #e74c3c;
            background: #fdf2f2;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.online {
            background: #d5f4e6;
            color: #27ae60;
        }
        .status.offline {
            background: #fdf2f2;
            color: #e74c3c;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .loading {
            color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
        
        <div class="test-section">
            <h3>ğŸ” Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
            <button onclick="testAll()">ğŸš€ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="checkServerStatus()">ğŸ–¥ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</button>
        </div>

        <div class="grid">
            <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
            <div class="test-section">
                <h3>1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h3>
                <button onclick="testBasicConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                <div id="basic-result" class="result"></div>
            </div>

            <!-- Ø§Ø®ØªØ¨Ø§Ø± API -->
            <div class="test-section">
                <h3>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± API</h3>
                <button onclick="testAPIEndpoint()">Ø§Ø®ØªØ¨Ø§Ø± requests.php</button>
                <button onclick="testAPIStatistics()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <div id="api-result" class="result"></div>
            </div>

            <!-- Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <div class="test-section">
                <h3>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <button onclick="testDatabaseConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                <button onclick="testDatabaseData()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <div id="database-result" class="result"></div>
            </div>

            <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
            <div class="test-section">
                <h3>4ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <button onclick="testGetRequests()">Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button onclick="testCreateRequest()">Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨</button>
                <div id="requests-result" class="result"></div>
            </div>

            <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª -->
            <div class="test-section">
                <h3>5ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
                <button onclick="testGetRatings()">Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
                <button onclick="testCreateRating()">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ…</button>
                <div id="ratings-result" class="result"></div>
            </div>

            <!-- Ø§Ø®ØªØ¨Ø§Ø± JavaScript API -->
            <div class="test-section">
                <h3>6ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± JavaScript API</h3>
                <button onclick="testJavaScriptAPI()">Ø§Ø®ØªØ¨Ø§Ø± database_new.js</button>
                <div id="js-api-result" class="result"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <div id="summary" class="result"></div>
        </div>
    </div>

    <script src="js/database_new.js"></script>
    <script>
        let testResults = {};
        let dbAPI = new DatabaseAPI();

        function addResult(sectionId, title, data, isSuccess = true) {
            const section = document.getElementById(sectionId);
            const timestamp = new Date().toLocaleString('ar-SA');
            const status = isSuccess ? 'âœ… Ù†Ø¬Ø­' : 'âŒ ÙØ´Ù„';
            const cssClass = isSuccess ? 'success-result' : 'error-result';
            
            const result = `[${timestamp}] ${status} - ${title}\n${JSON.stringify(data, null, 2)}\n\n`;
            section.innerHTML += `<div class="${cssClass}">${result}</div>`;
            section.scrollTop = section.scrollHeight;
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ù…Ù„Ø®Øµ
            testResults[title] = { success: isSuccess, data: data, timestamp: timestamp };
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r.success).length;
            const failed = total - passed;
            
            let summaryText = `ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:\n`;
            summaryText += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ${total}\n`;
            summaryText += `â€¢ Ù†Ø¬Ø­: ${passed} âœ…\n`;
            summaryText += `â€¢ ÙØ´Ù„: ${failed} âŒ\n`;
            summaryText += `â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${total > 0 ? Math.round((passed/total) * 100) : 0}%\n\n`;
            
            summaryText += `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:\n`;
            for (const [test, result] of Object.entries(testResults)) {
                const icon = result.success ? 'âœ…' : 'âŒ';
                summaryText += `${icon} ${test} - ${result.timestamp}\n`;
            }
            
            summary.innerHTML = summaryText;
        }

        async function testBasicConnection() {
            try {
                addResult('basic-result', 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', { status: 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...' });
                
                const response = await fetch(window.location.origin);
                const isSuccess = response.ok;
                
                addResult('basic-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', {
                    url: window.location.origin,
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries())
                }, isSuccess);
                
            } catch (error) {
                addResult('basic-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', {
                    error: error.message,
                    stack: error.stack
                }, false);
            }
            updateSummary();
        }

        async function testAPIEndpoint() {
            try {
                const url = 'http://localhost/projeect/api/requests.php?action=test';
                addResult('api-result', 'Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± API', { url: url });
                
                const response = await fetch(url);
                const text = await response.text();
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    data = { rawResponse: text, parseError: e.message };
                }
                
                addResult('api-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© API', {
                    url: url,
                    status: response.status,
                    data: data
                }, response.ok && data.success);
                
            } catch (error) {
                addResult('api-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© API', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testAPIStatistics() {
            try {
                const url = 'http://localhost/projeect/api/requests.php?action=get_statistics';
                const response = await fetch(url);
                const data = await response.json();
                
                addResult('api-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª API', {
                    url: url,
                    status: response.status,
                    data: data
                }, response.ok && data.success);
                
            } catch (error) {
                addResult('api-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª API', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testDatabaseConnection() {
            try {
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± PHP Ù…Ù†ÙØµÙ„
                const url = 'http://localhost/projeect/test_db_connection.php';
                const response = await fetch(url);
                const data = await response.json();
                
                addResult('database-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', {
                    url: url,
                    data: data
                }, data.success);
                
            } catch (error) {
                addResult('database-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testDatabaseData() {
            try {
                const url = 'http://localhost/projeect/api/requests.php?action=get_all';
                const response = await fetch(url);
                const data = await response.json();
                
                addResult('database-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', {
                    url: url,
                    recordCount: data.data ? data.data.length : 0,
                    data: data
                }, response.ok && data.success);
                
            } catch (error) {
                addResult('database-result', 'Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testGetRequests() {
            try {
                const result = await dbAPI.getAllRequests();
                
                addResult('requests-result', 'Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ø¨Ø± JavaScript', {
                    success: result.success,
                    requestCount: result.data ? result.data.length : 0,
                    message: result.message,
                    sampleData: result.data ? result.data.slice(0, 2) : null
                }, result.success);
                
            } catch (error) {
                addResult('requests-result', 'Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ø¨Ø± JavaScript', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testCreateRequest() {
            try {
                const testRequest = {
                    user_id: 2,
                    request_type: 'technical',
                    subject: 'Ø·Ù„Ø¨ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„',
                    description: 'Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                    priority: 'medium'
                };
                
                const url = 'http://localhost/projeect/api/requests.php';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: 'create', ...testRequest })
                });
                
                const data = await response.json();
                
                addResult('requests-result', 'Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', {
                    request: testRequest,
                    response: data
                }, response.ok && data.success);
                
            } catch (error) {
                addResult('requests-result', 'Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testGetRatings() {
            try {
                const result = await dbAPI.getRatings();
                
                addResult('ratings-result', 'Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', {
                    success: result.success,
                    ratingCount: result.ratings ? result.ratings.length : 0,
                    message: result.message,
                    sampleData: result.ratings ? result.ratings.slice(0, 2) : null
                }, result.success);
                
            } catch (error) {
                addResult('ratings-result', 'Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testCreateRating() {
            try {
                const testRating = {
                    action: 'rate_request',
                    request_id: 1,
                    user_id: 2,
                    quality_rate: 5,
                    speed_rate: 4,
                    comments: 'ØªÙ‚ÙŠÙŠÙ… ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„'
                };
                
                const url = 'http://localhost/projeect/api/requests.php';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testRating)
                });
                
                const data = await response.json();
                
                addResult('ratings-result', 'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯', {
                    rating: testRating,
                    response: data
                }, response.ok && data.success);
                
            } catch (error) {
                addResult('ratings-result', 'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function testJavaScriptAPI() {
            try {
                addResult('js-api-result', 'Ø§Ø®ØªØ¨Ø§Ø± ØªÙ‡ÙŠØ¦Ø© DatabaseAPI', {
                    baseURL: dbAPI.baseURL,
                    requestsAPI: dbAPI.requestsAPI,
                    authAPI: dbAPI.authAPI
                }, true);
                
                // Ø§Ø®ØªØ¨Ø§Ø± getStatistics
                const stats = await dbAPI.getStatistics();
                addResult('js-api-result', 'Ø§Ø®ØªØ¨Ø§Ø± getStatistics', stats, stats.success);
                
            } catch (error) {
                addResult('js-api-result', 'Ø§Ø®ØªØ¨Ø§Ø± JavaScript API', {
                    error: error.message
                }, false);
            }
            updateSummary();
        }

        async function checkServerStatus() {
            const services = [
                { name: 'Apache', url: 'http://localhost/', description: 'Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙŠØ¨' },
                { name: 'PHP', url: 'http://localhost/projeect/', description: 'Ù…Ø¹Ø§Ù„Ø¬ PHP' },
                { name: 'API', url: 'http://localhost/projeect/api/requests.php?action=test', description: 'ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª' }
            ];
            
            for (const service of services) {
                try {
                    const response = await fetch(service.url);
                    const status = response.ok ? 'Ù…ØªØµÙ„' : 'Ø®Ø·Ø£';
                    const statusClass = response.ok ? 'online' : 'offline';
                    
                    addResult('basic-result', `Ø­Ø§Ù„Ø© ${service.name}`, {
                        service: service.description,
                        url: service.url,
                        status: status,
                        httpStatus: response.status
                    }, response.ok);
                    
                } catch (error) {
                    addResult('basic-result', `Ø­Ø§Ù„Ø© ${service.name}`, {
                        service: service.description,
                        url: service.url,
                        status: 'ØºÙŠØ± Ù…ØªØµÙ„',
                        error: error.message
                    }, false);
                }
            }
            updateSummary();
        }

        async function testAll() {
            clearResults();
            addResult('summary', 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©', { timestamp: new Date().toLocaleString('ar-SA') });
            
            await testBasicConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await checkServerStatus();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAPIEndpoint();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAPIStatistics();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDatabaseConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDatabaseData();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetRequests();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetRatings();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testJavaScriptAPI();
            
            addResult('summary', 'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©', { 
                timestamp: new Date().toLocaleString('ar-SA'),
                totalTests: Object.keys(testResults).length
            });
        }

        function clearResults() {
            const resultDivs = document.querySelectorAll('.result');
            resultDivs.forEach(div => div.innerHTML = '');
            testResults = {};
            updateSummary();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            addResult('summary', 'ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', { 
                timestamp: new Date().toLocaleString('ar-SA'),
                userAgent: navigator.userAgent,
                url: window.location.href
            });
            updateSummary();
        };
    </script>
</body>
</html>